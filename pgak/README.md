# PGAKstack

![Prometheus](https://img.shields.io/badge/Prometheus-E6522C?style=for-the-badge&logo=Prometheus&logoColor=white)
![Grafana](https://img.shields.io/badge/grafana-%23F46800.svg?style=for-the-badge&logo=grafana&logoColor=white)
![Alertmanager](https://img.shields.io/badge/Alertmanager-CB2029?style=for-the-badge&logo=Prometheus&logoColor=white)
![Karma](https://img.shields.io/badge/-Karma-%23Clojure?style=for-the-badge&logo=Karma&logoColor=white)
![Traefik](https://img.shields.io/badge/Traefik-18BFFF?style=for-the-badge&logo=Traefik&logoColor=white)

Monitoring your system resources, statisitics with [Prometheus](prometheus.io) + [Grafana](grafana.org) + [Alertmanager](https://prometheus.io/docs/alerting/latest/alertmanager/) + [Karma](https://karma-dashboard.io/) Stack. The stack pushes its alerts to [Slack](https://slack.com/) that make it easier to observe your system and aware of the harm to your system. Using [traefik.me](traefik.me) DNS for routing and access to services in Swarm mode. There are two modes for the stack:

- *Without letsencrypt*: This deploys your stack with the [traefik.me](traefik.me) domain, it used to get local access through traefik.me.
- *With letsencrypt*: This deploys your stack with a self-managed domain, letsencrypt for TLS and it used to get external access.

## Deploy stack

```
docker stack deploy -c traefik.yml reverse_proxy
docker stack deploy -c pgak.yml pgak
```

## Without Letsencrypt Variables

| Name | Description | Default |
|------|-------------|---------|
|<a name="DOMAIN"></a> [DOMAIN](#) | Set DNS for cotainers resource | `traefik.me` |
|<a name="TRAEFIK_USER"></a> [TRAEFIK_USER](#) | User for traefik middlewares authentication  | `admin` |
|<a name="TRAEFIK_PASSWD"></a> [TRAEFIK_PASSWORD](#) | Password for traefik middlewares authentication  | `Null` |
|<a name="GF_ADMIN_USER"></a> [GF_ADMIN_USER](#) | User for Grafana dashboard  | `admin` |
|<a name="GF_ADMIN_PASSWORD"></a> [GF_ADMIN_PASSWORD](#) | Password for Grafana dashboard  | `False` |
|<a name="PROM_AUTH_USER"></a> [PROM_AUTH_USER](#) | User for prometheus middlewares authentication  | `admin` |
|<a name="PROM_AUTH_PASSWD"></a> [TRAEFIK_PASSWORD](#) | Password for prometheus middlewares authentication  | `Null` |
|<a name="AM_AUTH_USER"></a> [AM_AUTH_USER](#) | User for alertmanager middlewares authentication  | `admin` |
|<a name="AM_AUTH_PASSWD"></a> [AM_AUTH_PASSWD](#) | Password for alertmanager middlewares authentication  | `Null` |
|<a name="KARMA_AUTH_USER"></a> [KARMA_AUTH_USER](#) | User for karma middlewares authentication  | `admin` |
|<a name="KARMA_AUTH_PASSWD"></a> [KARMA_AUTH_PASSWD](#) | Password for karma middlewares authentication  | `Null` |

## With Letsencrypt Variables

| Name | Description | Default |
|------|-------------|---------|
|<a name="DOMAIN"></a> [DOMAIN](#) | Set DNS for cotainers resource | `Null` |
|<a name="LE_EMAIL"></a> [LE_EMAIL](#) | Set email address for the letsencrypt | `Null` |
|<a name="TRAEFIK_USER"></a> [TRAEFIK_USER](#) | User for traefik middlewares authentication  | `admin` |
|<a name="TRAEFIK_PASSWD"></a> [TRAEFIK_PASSWORD](#) | Password for traefik middlewares authentication  | `Null` |
|<a name="GF_ADMIN_USER"></a> [GF_ADMIN_USER](#) | User for Grafana dashboard  | `admin` |
|<a name="GF_ADMIN_PASSWORD"></a> [GF_ADMIN_PASSWORD](#) | Password for Grafana dashboard  | `Null` |
|<a name="PROM_AUTH_USER"></a> [PROM_AUTH_USER](#) | User for prometheus middlewares authentication  | `admin` |
|<a name="PROM_AUTH_PASSWD"></a> [TRAEFIK_PASSWORD](#) | Password for prometheus middlewares authentication  | `Null` |
|<a name="AM_AUTH_USER"></a> [AM_AUTH_USER](#) | User for alertmanager middlewares authentication  | `admin` |
|<a name="AM_AUTH_PASSWD"></a> [AM_AUTH_PASSWD](#) | Password for alertmanager middlewares authentication  | `Null` |
|<a name="KARMA_AUTH_USER"></a> [KARMA_AUTH_USER](#) | User for karma middlewares authentication  | `admin` |
|<a name="KARMA_AUTH_PASSWD"></a> [KARMA_AUTH_PASSWD](#) | Password for karma middlewares authentication  | `Null` |


* **Note**: for `*_PASSWORD` variables, it must be generated by `htpasswd`. However, the `GF_ADMIN_PASSWORD` must be a plain TEXT. Example, to generate for the password variable

```
htpasswd -nBC 10 $TRAEFIK_USER
```

## Define slack variable
To send alert to your slack workspace, make sure you update content for the [YAML](/alertmanager/config.yml) file. Plesae specify for `(( API ))` and `(( channel ))` variables that are from your slack configuration.

## Define alert rules
Refer at [Awesome prometheus alerts](https://awesome-prometheus-alerts.grep.to/) you can customize your rules to [rules](/prometheus/rules.yml)

## TLS
For the stack that use [traefik.me](traefik.me) domain, it can use the free SSL provided by [traefik.me](traefik.me) itself. The certs could be found at [cert.pem](http://traefik.me/cert.pem) and [privkey](http://traefik.me/privkey.pem)